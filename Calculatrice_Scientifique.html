<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Walid Irhil — Calculatrice Scientifique</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
  --accent:#7c3aed; --accent-hover:#9333ea; --danger:#ef4444;
  --radius:14px; --gap:10px; --shadow:0 8px 24px rgba(2,6,23,0.6);
  --transition:0.4s; --glow:0 0 12px var(--accent);
}

/* THEMES */
body.dark{
  --bg:#0f1724; --card:#0b1220; --muted:#9aa6b2; --glass: rgba(255,255,255,0.04); --btn-bg: rgba(255,255,255,0.08);
  color:#e6eef8;
}
body.light{
  --bg:#f3f4f6; --card:#ffffff; --muted:#6b7280; --glass: rgba(0,0,0,0.03); --btn-bg: rgba(0,0,0,0.05);
  color:#111827;
}

html, body{height:100%; background:var(--bg); display:flex; align-items:center; justify-content:center; padding:28px; font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; transition: all var(--transition);}
*{box-sizing:border-box;}

.container{width:100%; max-width:1080px; display:grid; grid-template-columns: 1fr 420px; gap:28px; align-items:start;}
.card{background:var(--card); padding:20px; border-radius:var(--radius); box-shadow:var(--shadow); transition: all var(--transition);}
h1{ text-align:center; font-size:1.8rem; margin-bottom:18px; color:var(--accent); }

.calc{padding:18px;}
.top-row{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;}
.title{font-weight:600; font-size:1.05rem;}
.small{font-size:0.86rem; color:var(--muted);}

.display{background:var(--glass); padding:16px; border-radius:12px; min-height:86px; display:flex; flex-direction:column; justify-content:space-between; gap:8px;}
.expr{font-size:0.95rem; color:var(--muted); overflow:auto; text-align:right; word-break:break-all;}
.result{font-size:1.8rem; font-weight:700; text-align:right; word-break:break-all; font-family: 'Roboto Mono', monospace; transition: all 0.2s;}
.result.glow{text-shadow: var(--glow);}

.controls{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;}
.chip{background:var(--btn-bg); padding:8px 14px; border-radius:999px; font-size:0.9rem; cursor:pointer; transition: all 0.2s;}
.chip:hover{background: rgba(255,255,255,0.2);}

.pad{margin-top:16px; display:grid; grid-template-columns: repeat(6, 1fr); gap:8px;}
button.key{background:transparent; border:0; padding:16px; border-radius:10px; cursor:pointer; font-size:1rem; color:inherit; box-shadow: inset 0 -2px 0 rgba(0,0,0,0.15); transition: all 0.2s; font-family: 'Roboto Mono', monospace;}
button.key:hover{background: rgba(255,255,255,0.12); transform: scale(1.05);}
button.key:active{transform:scale(0.95); box-shadow: inset 0 -2px 6px rgba(0,0,0,0.3);}

/* bouton = taille comme Retour */
button.eval-btn {
  grid-column: span 2;
  font-size: 1rem; /* même taille que le texte du bouton Retour */
  padding: 12px;   /* même padding que Retour */
  background: linear-gradient(90deg, #f59e0b, #d97706);
  color: #fff;
  border-radius: var(--radius);
  box-shadow: 0 4px 15px rgba(245,158,11,0.6);
  transition: transform 0.2s, box-shadow 0.2s;
}
button.eval-btn:hover { transform: scale(1.03); box-shadow: 0 0 15px #f59e0b; }
button.eval-btn:active { transform: scale(0.95); box-shadow: 0 0 10px #f59e0b; }

.op{background:rgba(255,255,255,0.04);}
.num{background:rgba(255,255,255,0.02);}
.accent{background:linear-gradient(90deg,var(--accent), var(--accent-hover)); color:white;}
.wide{grid-column:span 2;}
.danger{background:linear-gradient(90deg,var(--danger), #ff7b7b); color:white;}

body.dark .key, body.dark .expr, body.dark .result, body.dark .hist-expr, body.dark .hist-res, body.dark .chip, body.dark .toggle{color:#fff;}
body.light .key, body.light .expr, body.light .result, body.light .hist-expr, body.light .hist-res, body.light .chip, body.light .toggle{color:#111827;}

.side{display:flex; flex-direction:column; gap:12px;}
.history{max-height:540px; overflow:auto; padding:12px; background:var(--glass); border-radius:10px;}
.hist-item{padding:8px;border-radius:8px; margin-bottom:8px; background:transparent; display:flex; justify-content:space-between; gap:8px; cursor:pointer; transition: background 0.2s, transform 0.15s;}
.hist-item:hover{background:rgba(255,255,255,0.05); transform: scale(1.02);}
.hist-expr{color:var(--muted); font-size:0.9rem;}
.hist-res{font-weight:600; font-family: 'Roboto Mono', monospace;}

.options{padding:12px; display:flex; gap:8px; flex-wrap:wrap;}
.toggle{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; background:var(--btn-bg); border-radius:999px; cursor:pointer;}

.return-btn{margin-top:20px; display:block; width:100%; text-align:center; padding:12px; background:linear-gradient(90deg,#2563eb,#9333ea); color:#fff; font-weight:600; border-radius:var(--radius); text-decoration:none; transition: all 0.3s;}
.return-btn:hover{opacity:0.9; transform: scale(1.02);}

@media (max-width:900px){
  .container{grid-template-columns:1fr; gap:16px;}
  .pad{grid-template-columns: repeat(5, 1fr);}
  .side{order:-1;}
}
</style>
</head>
<body class="dark">
<div class="container">
  <div class="card calc">
    <h1><span class="highlight">Walid Irhil</span> — Calculatrice Scientifique</h1>

    <div class="top-row">
      <div><div class="title">Interface moderne</div><div class="small">HTML / CSS / JS</div></div>
      <div style="display:flex; gap:8px; align-items:center">
        <div class="chip" id="modeToggle">Mode: <strong id="angleMode">DEG</strong></div>
        <div class="chip" id="themeToggle">Thème</div>
      </div>
    </div>

    <div class="display" id="display">
      <div class="expr" id="expression">0</div>
      <div class="result" id="result">0</div>
    </div>

    <div class="controls">
      <div class="chip danger" id="btn-clear">C</div>
      <div class="chip" id="btn-del">DEL</div>
      <div class="chip" id="btn-paren-open">(</div>
      <div class="chip" id="btn-paren-close">)</div>
      <div class="chip" id="btn-pi">π</div>
      <div class="chip" id="btn-e">e</div>
    </div>

    <div class="pad" id="pad">
      <button class="key op" data-val="sin(">sin</button>
      <button class="key op" data-val="cos(">cos</button>
      <button class="key op" data-val="tan(">tan</button>
      <button class="key op" data-val="asin(">asin</button>
      <button class="key op" data-val="acos(">acos</button>
      <button class="key op" data-val="atan(">atan</button>
      <button class="key op" data-val="log10(">log</button>
      <button class="key op" data-val="ln(">ln</button>
      <button class="key op" data-val="sqrt(">√</button>
      <button class="key op" data-val="^">^</button>

      <button class="key num" data-val="7">7</button>
      <button class="key num" data-val="8">8</button>
      <button class="key num" data-val="9">9</button>
      <button class="key op" data-val="/">÷</button>
      <button class="key op" data-val="%">%</button>

      <button class="key num" data-val="4">4</button>
      <button class="key num" data-val="5">5</button>
      <button class="key num" data-val="6">6</button>
      <button class="key op" data-val="*">×</button>
      <button class="key op" data-val="!">!</button>

      <button class="key num" data-val="1">1</button>
      <button class="key num" data-val="2">2</button>
      <button class="key num" data-val="3">3</button>
      <button class="key op" data-val="-">−</button>
      <button class="key op" data-val="^2">x²</button>

      <button class="key num wide" data-val="0">0</button>
      <button class="key num" data-val="," id="dec">.</button>
      <button class="key op" data-val="+">+</button>
      <button class="key accent eval-btn" id="btn-eval">=</button>
    </div>

    <a href="index.html" class="return-btn">Retour</a>
  </div>

  <div class="side">
    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px">
        <div style="font-weight:600">Historique</div>
        <div style="display:flex; gap:8px">
          <div class="chip" id="btn-copy">Copier</div>
          <div class="chip danger" id="btn-clear-history">Effacer</div>
        </div>
      </div>
      <div class="history" id="history"></div>
    </div>

    <div class="card options">
      <div class="small">Options</div>
      <div class="toggle" id="deg">DEG</div>
      <div class="toggle" id="rad">RAD</div>
      <div class="toggle" id="precision">Précision: <strong id="precVal">6</strong></div>
    </div>
  </div>
</div>

<script>
const exprEl=document.getElementById('expression');
const resEl=document.getElementById('result');
const historyEl=document.getElementById('history');
const angleModeEl=document.getElementById('angleMode');
let expression=''; let angleMode='DEG'; let precision=6;
const history=[];

function updateDisplay(){
  exprEl.textContent = expression || '0';
  try{ const val = safeEval(expression); resEl.textContent = formatNumber(val); resEl.classList.add('glow'); setTimeout(()=>resEl.classList.remove('glow'),300);}catch(e){ resEl.textContent='Erreur'; }
}

function formatNumber(x){
  if(typeof x==='number' && !isFinite(x)) return '∞';
  if(typeof x==='number' && Math.abs(x)<1e-12) return '0';
  if(typeof x==='number') return Number.parseFloat(x).toPrecision(precision).replace(/(?:\.0+|(?<=\.[0-9]*)0+)$/,'');
  return x;
}

function safeEval(input){
  if(!input) return 0;
  const allowed=/^[0-9+\-*/%^()., eE!a-zA-Zπ]+$/;
  if(!allowed.test(input)) throw new Error('Caractère non autorisé');
  let s=input.replace(/,/g,'.').replace(/×/g,'*').replace(/÷/g,'/');
  if(s.includes('!')) s=s.replace(/(\d+(?:\.\d+)?)!/g,(_,n)=> 'fact('+n+')');
  s=s.replace(/(\d+\.?\d*)\^(\d+\.?\d*)/g,'Math.pow($1,$2)');
  s=s.replace(/\bπ\b/g,'Math.PI').replace(/\be\b/gi,'Math.E');
  s=s.replace(/\^/g,'**');
  const scope={Math,
    sin:x=> angleMode==='DEG'? Math.sin(x*Math.PI/180):Math.sin(x),
    cos:x=> angleMode==='DEG'? Math.cos(x*Math.PI/180):Math.cos(x),
    tan:x=> angleMode==='DEG'? Math.tan(x*Math.PI/180):Math.tan(x),
    asin:x=> angleMode==='DEG'? Math.asin(x)*180/Math.PI:Math.asin(x),
    acos:x=> angleMode==='DEG'? Math.acos(x)*180/Math.PI:Math.acos(x),
    atan:x=> angleMode==='DEG'? Math.atan(x)*180/Math.PI:Math.atan(x),
    log10:x=> Math.log10? Math.log10(x):Math.log(x)/Math.LN10,
    ln:x=> Math.log(x),
    sqrt:x=> Math.sqrt(x),
    fact:n=>{ n=Math.floor(Number(n)); if(n<0) return NaN; let r=1; for(let i=2;i<=n;i++) r*=i; return r; }
  };
  const keys=Object.keys(scope); const vals=keys.map(k=>scope[k]);
  const fn=new Function(...keys,'return ('+s+');'); return fn(...vals);
}

document.getElementById('pad').addEventListener('click',e=>{ const btn=e.target.closest('button'); if(!btn) return; const val=btn.dataset.val; if(val){ expression += val==='x²'? '^2':val; updateDisplay(); } });
document.getElementById('btn-clear').addEventListener('click',()=>{ expression=''; updateDisplay(); });
document.getElementById('btn-del').addEventListener('click',()=>{ expression=expression.slice(0,-1); updateDisplay(); });
document.getElementById('btn-paren-open').addEventListener('click',()=>{ expression+='('; updateDisplay(); });
document.getElementById('btn-paren-close').addEventListener('click',()=>{ expression+=')'; updateDisplay(); });
document.getElementById('btn-pi').addEventListener('click',()=>{ expression+='π'; updateDisplay(); });
document.getElementById('btn-e').addEventListener('click',()=>{ expression+='e'; updateDisplay(); });
document.getElementById('btn-eval').addEventListener('click',evaluateCurrent);

function evaluateCurrent(){
  try{
    const val=safeEval(expression);
    history.unshift({expr:expression,res:val});
    renderHistory();
    expression=String(val);
    updateDisplay();
  }catch(e){ resEl.textContent='Erreur'; }
}

function renderHistory(){
  historyEl.innerHTML='';
  history.slice(0,50).forEach(it=>{
    const div=document.createElement('div'); div.className='hist-item';
    div.innerHTML=`<div class="hist-expr">${it.expr}</div><div class="hist-res">${formatNumber(it.res)}</div>`;
    div.addEventListener('click',()=>{ expression=it.res.toString(); updateDisplay(); });
    historyEl.appendChild(div);
  });
}

document.getElementById('btn-clear-history').addEventListener('click',()=>{ history.length=0; renderHistory(); });
document.getElementById('btn-copy').addEventListener('click',()=>{ navigator.clipboard.writeText(resEl.textContent).then(()=>alert('Résultat copié')); });

document.getElementById('deg').addEventListener('click',()=>{ angleMode='DEG'; angleModeEl.textContent='DEG'; updateDisplay(); });
document.getElementById('rad').addEventListener('click',()=>{ angleMode='RAD'; angleModeEl.textContent='RAD'; updateDisplay(); });

document.getElementById('themeToggle').addEventListener('click',()=>{
  document.body.classList.toggle('dark'); document.body.classList.toggle('light');
});

window.addEventListener('keydown',e=>{
  if(e.key==='Enter'){ e.preventDefault(); evaluateCurrent(); }
  else if(e.key==='Backspace'){ expression=expression.slice(0,-1); updateDisplay(); }
  else if(/^[0-9+\-*/().,%]$/.test(e.key)){ expression+=e.key; updateDisplay(); }
  else if(e.key==='.'){ expression+='.'; updateDisplay(); }
});

updateDisplay();
</script>
</body>
</html>
